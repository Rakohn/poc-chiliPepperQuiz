<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contrôle des Buzzers</title>
</head>
<body>
    <h1>Game master control panel</h1>
    <h2>Contrôle des Jingles</h2>

    <div>
        <h2>Jingles</h2>
        <button onclick="playJingle(1)">Jingle 1</button>
        <button onclick="playJingle(2)">Jingle 2</button>
        <button onclick="playJingle(3)">Jingle 3</button>
        <button onclick="playJingle(4)">Jingle 4</button>
        <button onclick="playJingle(5)">Jingle 5</button>
        <button onclick="playJingle(6)">Jingle 6</button>
    </div>

    <h2>Contrôle des Buzzers</h2>

    <div>
        <button onclick="lockAll()">Verrouiller tous les buzzers</button>
        <button onclick="unlockAll()">Déverrouiller tous les buzzers</button>
        <button onclick="resetGame()">Reset de la partie</button>
    </div>

    <!-- <div>
        <h3>Status en direct</h3>
        <div id="buzzer-status">En attente de connexion...</div>
    </div> -->

    <div>
        <h3>Status en direct</h3>
        <div id="buzzer-status">Aucune équipe n'a la main</div>
        <button id="validateButton" onclick="validateMock()" style="display:none;">
            Valider la réponse
        </button>
        <button id="invalidateButton" onclick="invalidateMock()" style="display:none;">
            Invalider la réponse
        </button>
    </div>

    <div id="buzzer-management" style="margin-top: 20px;">
        <h3>Gestion des Équipes</h3>
        <button id="loadBuzzers">Charger les Buzzers Connectés</button>
        <div id="buzzerListContainer" style="margin-top: 20px;">
            <!-- La liste des buzzers connectés sera générée ici -->
        </div>
        <button id="saveTeams" style="margin-top: 20px;">Enregistrer</button>
    </div>

    <script>
        const mockChannel = new BroadcastChannel('scoreChannel');

        // Réception des messages du buzzer mock
        mockChannel.onmessage = (event) => {
            const { action, team } = event.data;

            if (action === 'update') {
                document.getElementById('buzzer-status').innerText =
                    `${team} a pris la main !`;

                // Affiche les boutons de validation/invalidation
                document.getElementById('validateButton').style.display = 'block';
                document.getElementById('invalidateButton').style.display = 'block';
            }
        };

        // Valider et ajouter un point au buzzer simulé
        function validateMock() {
            showNotification('Réponse validée.');
            unlockBuzzers();
            hideValidationButtons();
        }

        // Invalider la réponse sans ajouter de point
        function invalidateMock() {
            showNotification('Réponse invalidée.');
            unlockBuzzers();
            hideValidationButtons();
        }

        // Déverrouille les buzzers
        function unlockBuzzers() {
            mockChannel.postMessage({
                action: 'unlock'
            });
        }

        // Cache les boutons de validation/invalidation
        function hideValidationButtons() {
            document.getElementById('validateButton').style.display = 'none';
            document.getElementById('invalidateButton').style.display = 'none';
        }

        // Notification simple
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.innerText = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.backgroundColor = '#4CAF50';
            notification.style.color = 'white';
            notification.style.padding = '15px';
            notification.style.borderRadius = '5px';
            notification.style.zIndex = '1000';
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>

    <!-- <script src="js/libs/signalr.min.js"></script> -->
    <script src="js/contolJingle.js"></script>
    <script src="js/buzzerManager.js"></script>
    <!-- <script src="js/buzzer.js"></script> -->
</body>
</html>
